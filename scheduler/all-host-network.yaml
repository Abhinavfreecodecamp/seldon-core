version: "3.9"

services:

  agent:
    network_mode: "host"
    volumes:
      - type: bind
        source: ./config
        target: /mnt/config
      - type: bind
        source: ./mnt
        target: /mnt/agent

  dataflow:
    network_mode: "host"
    environment:
      - SELDON_UPSTREAM_HOST=localhost

  envoy:
    network_mode: "host"
    command:
      - "/usr/local/bin/envoy"
      - "-c"
      - "/etc/envoy-local.yaml"

  modelgateway:
    network_mode: "host"
    volumes:
      - type: bind
        source: ./config
        target: /mnt/config
    command:
      - "/bin/modelgateway"
      - "--log-level"
      - "debug"
      - "--config-path"
      - "/mnt/config"
      - "--scheduler-port"
      - ${SCHEDULER_SERVER_PORT}
      - "--envoy-port"
      - ${ENVOY_DATA_PORT}

  rclone:
    network_mode: "host"
    volumes:
      - type: bind
        source: ${PWD}/mnt
        target: ${PWD}/mnt

  scheduler:
    network_mode: "host"

  server:
    network_mode: "host"
    volumes:
      - type: bind
        source: ./mnt
        target: /mnt/agent

