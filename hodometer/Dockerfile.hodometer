FROM golang:1.18-alpine as builder

RUN apk add --upgrade make cmake

WORKDIR /build
ADD . .

RUN rm -r apis && mv apis-TEMP apis

ARG GIT_BRANCH
ARG GIT_COMMIT
ARG RELEASE_TYPE

RUN make build-hodometer

################################################################################

FROM golang:1.18-alpine
COPY --from=builder /build/bin/hodometer /bin/hodometer

ARG UID=1000
ARG GID=1000
USER ${UID}:${GID}

CMD ["/bin/hodometer"]
