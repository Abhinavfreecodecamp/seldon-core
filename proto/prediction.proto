// [START declaration]
syntax = "proto3";

import "google/protobuf/struct.proto";

package seldon.protos;
// [END declaration]

// [START java_declaration]
option java_package = "io.seldon.protos";
option java_outer_classname = "PredictionProtos";
// [END java_declaration]

// [START messages]

// [START default data]

message Tensor {
  repeated int32 shape  = 2 [packed=true];
  repeated double values = 3 [packed=true];
}

message DefaultDataDef {
  repeated string features = 1;
  oneof data_oneof {
    Tensor tensor = 2;
    google.protobuf.ListValue ndarray = 3;
  }
}


// [END default data]


// [START Prediction Request]

message PredictionRequestDef {

  PredictionRequestMetaDef meta = 1;
  oneof request_oneof {
    DefaultDataDef request = 2;
    bytes binRequest = 3;
    string strRequest = 4;
  }

}

message Tag{
  repeated string value = 1;
}

message PredictionRequestMetaDef {
  string puid = 1; 
  map<string,google.protobuf.Value> tags = 2;
}


// [END Prediction Request]


// [START Prediction Response]

message PredictionResponseDef {

  PredictionStatusDef status = 1;
  PredictionResponseMetaDef meta = 2;
  oneof response_oneof {
    DefaultDataDef response = 3;
    bytes binResponse = 4;
    string strResponse = 5;
  }
}

message PredictionStatusDef {

    enum Status {
        SUCCESS = 0;
        FAILURE = 1;
    }

    int32 code = 1;
    string info = 2;
    string reason = 3;
    Status status = 4;
}

message OutlierStatus{
    bool isOutlier = 1;
    double score = 2;
}

message PredictionResponseMetaDef {
  string puid = 1; 
  map<string,int32> routing = 2;
  OutlierStatus outlierStatus = 3;
}


// [END Prediction Response]

// [START Feedback]

message PredictionFeedbackDef {
  PredictionRequestDef request = 1;
  PredictionResponseDef response = 2;
  float reward = 3;
  DefaultDataDef truth = 4;
}

// [END Feedback]


message PredictionRequestResponseDef {
  PredictionRequestDef request = 1;
  PredictionResponseDef response = 2;
}

service MAB {
  rpc Route (PredictionRequestDef) returns (RouteResponseDef) {};
  rpc Train (PredictionFeedbackDef) returns (PredictionFeedbackResponseDef) {};
}

message RouteResponseDef {
	int32 branch = 1;
}

message PredictionFeedbackResponseDef {
	bool success = 1;
}
	
service Model {
  rpc Predict(PredictionRequestDef) returns (PredictionResponseDef) {};
 }